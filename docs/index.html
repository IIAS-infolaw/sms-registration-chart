<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
	<script src="vendor/chart.min.js"></script>
	<script src="vendor/chartjs-adapter-date-fns.bundle.min.js"></script>
	<script src="vendor/chartjs-plugin-annotation.min.js"></script>
	<script src="vendor/chartjs-plugin-crosshair.min.js"></script>
</head>
<body>
	<main>
		<canvas id="chart" width="1200" height="640"></canvas>
	</main>
	<script src="data/ncc.js"></script>
	<script src="data/cdc.js"></script>
	<script src="data/env.js"></script>
	<script type="text/javascript">
		const ctx = document.getElementById("chart");
		const chart = new Chart(ctx, {
			data: {
				datasets: [{
					type: 'line',
					label: '簡訊數（從 NCC 傳送總數推估）',
					borderColor: '#5087ec',
					data: dataNCC.SENT,
					yAxisID: 'ySMS',
					stepped: 'after',
					parsing: {
						yAxisKey: 'ns'
					}
				}, {
					type: 'line',
					label: '簡訊數（從 NCC 刪除總數推估）',
					borderColor: '#a9c2ef',
					data: dataNCC.DELETED,
					yAxisID: 'ySMS',
					stepped: 'after',
					parsing: {
						yAxisKey: 'nd'
					}
				}, {
					type: 'line',
					label: '簡訊數（從刪除總數推估）',
					borderColor: '#5087ec',
					data: dataCDC,
					yAxisID: 'ySMS',
					parsing: {
						yAxisKey: 'cd'
					}
				}, {
					type: 'line',
					label: '調閱數',
					borderColor: '#5087ec',
					data: dataCDC,
					yAxisID: 'yReq',
					parsing: {
						yAxisKey: 'cr'
					}
				}, {
					type: 'line',
					label: '新增本土確診數',
					borderColor: '#d95040',
					data: dataEnv,
					yAxisID: 'yCase',
					parsing: {
						yAxisKey: 'cl'
					}
				}, {
					type: 'line',
					label: '總送驗數',
					borderColor: '#f2bd42',
					data: dataEnv,
					yAxisID: 'yTest',
					parsing: {
						yAxisKey: 't'
					}
				}, {
					type: 'line',
					label: '零售店與休閒設施',
					borderColor: '#f2bd42',
					borderDash: [1.25, 1.25],
					borderWidth: 1.25,
					data: dataEnv,
					yAxisID: 'yMobility',
					parsing: {
						yAxisKey: 'mr'
					}
				}, {
					type: 'line',
					label: '雜貨店和藥局',
					borderColor: '#58a45c',
					borderDash: [1.25, 1.25],
					borderWidth: 1.25,
					data: dataEnv,
					yAxisID: 'yMobility',
					parsing: {
						yAxisKey: 'mg'
					}
				}, {
					type: 'line',
					label: '大眾運輸',
					borderColor: '#ee752f',
					borderDash: [1.25, 1.25],
					borderWidth: 1.25,
					data: dataEnv,
					yAxisID: 'yMobility',
					parsing: {
						yAxisKey: 'mt'
					}
				}, {
					type: 'line',
					label: '工作場所',
					borderColor: '#68bbc4',
					borderDash: [1.25, 1.25],
					borderWidth: 1.25,
					data: dataEnv,
					yAxisID: 'yMobility',
					parsing: {
						yAxisKey: 'mw'
					}
				}]
			},
			options: {
				normalized: true,
				elements: {
					line: {
						borderJoinStyle: 'round'
					},
					point: {
						pointRadius: 0,
						pointHitRadius: 4
					}
				},
				interaction: {
					mode: 'nearest',
					axis: 'x',
					intersect: false
				},
				plugins: {
					title: {
						display: true,
						text: '1922 簡訊實聯制使用趨勢（對照疫情與人流）',
						font: {
							size: 16
						}
					},
					subtitle: {
						display: true,
						text: '資料來源：衛生福利部疾病管制署、Google 社區人流報告'
					},
					legend: {
						labels: {
							boxWidth: 16,
							boxHeight: 0
						}
					},
					crosshair: {
						line: {
							color: 'rgba(127,127,127,.2)'
						},
						snapping: {
							enabled: true
						}
					}
				},
				scales: {
					x: {
						type: 'time',
						min: '2021-05-19',
						max: '2022-05-26',
						time: {
							tooltipFormat: 'PPP',
							unit: 'month'
						},
						ticks: {
							align: 'start',
							maxTicksLimit: 15
						}
					},
					ySMS: {
						beginAtZero: true,
						title: {
							display: true,
							text: '簡訊數量（則，M = 百萬）'
						},
						ticks: {
							callback: (v) => `${Math.round(v/1000000)}M`
						}
					},
					yReq: {
						beginAtZero: true,
						position: 'right',
						display: 'auto',
						title: {
							display: true,
							text: '調閱數（筆，K = 千）'
						},
						ticks: {
							callback: (v) => `${Math.round(v/1000)}K`
						}
					},
					yCase: {
						beginAtZero: true,
						max: 1000,
						position: 'right',
						title: {
							display: true,
							text: '確診人數（人）'
						},
						grid: {
							display: false
						}
					},
					yTest: {
						beginAtZero: true,
						suggestedMax: 240000,
						position: 'right',
						display: 'auto',
						title: {
							display: true,
							text: '送驗數（件，K = 千）'
						},
						ticks: {
							callback: (v) => `${Math.round(v/1000)}K`
						}
					},
					yMobility: {
						suggestedMax: 200,
						suggestedMin: -100,
						position: 'right',
						display: 'auto',
						title: {
							display: true,
							text: '人流與全球疫情爆發前相較之增減（%）'
						},
						grid: {
							display: false
						},
						ticks: {
							callback: (v) => `${v}%`
						}
					}
				}
			}
		});
	</script>
</body>
</html>
